#!/bin/bash
###############################
# Written by Tsali            #
#       github.com/tsali      #
# Created  2018/06/19         #
# Updated  2025/09/10         #
###############################

# Default: interactive mode
QUIET=0

# Check for -q flag
if [[ "$1" == "-q" ]]; then
    QUIET=1
    shift
fi

# Get ASN from CLI argument or prompt
if [ -n "$1" ]; then
    ASN="$1"
else
    read -p "Enter the ASN: " ASN
fi

echo ""
echo "=== ASN Route Lookup Tool ==="
echo ""

# Define registries and whois servers
registries=("RADB" "ARIN" "APNIC" "RIPE" "LACNIC" "AFRINIC")
hosts=("whois.radb.net" "whois.arin.net" "whois.apnic.net" "whois.ripe.net" "whois.lacnic.net" "whois.afrinic.net")

for i in "${!registries[@]}"; do
    # Fetch routes
    routes=$(whois -h "${hosts[$i]}" -i origin "AS$ASN" 2>/dev/null | awk '/\/[0-9]+/ {print $2}' | sort -u)
    
    # Skip empty results
    if [ -n "$routes" ]; then
        echo "Advertised routes for AS$ASN per ${registries[$i]}:"
        echo "$routes"
        echo ""
        # Only prompt if not quiet
        if [ "$QUIET" -eq 0 ]; then
            read -p "Press any key to continue..."
            echo ""
        fi
    fi
done

echo "Done."
